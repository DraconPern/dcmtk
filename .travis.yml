language: cpp
compiler:
    - gcc

os:
    - linux
    - osx

# use containers
sudo: false

env:
  - TYPE=Release DEVSPACE=$TRAVIS_BUILD_DIR/..

script:
  - git clone --depth 1 git://git.dcmtk.org/dcmtk.git dcmtksrc
  - cd dcmtksrc && mkdir -p build-$TYPE && cd build-$TYPE
  - cmake .. -DDCMTK_WITH_TIFF=OFF -DDCMTK_WITH_PNG=OFF -DDCMTK_WITH_OPENSSL=OFF -DDCMTK_WITH_XML=OFF -DDCMTK_WITH_ZLIB=ON -DDCMTK_WITH_SNDFILE=OFF -DDCMTK_WITH_ICONV=OFF -DDCMTK_WITH_WRAP=OFF -DCMAKE_INSTALL_PREFIX=$DEVSPACE/dcmtk/$TYPE 
  - make -j8 install
before_deploy:
  - cd $TRAVIS_BUILD_DIR/..
  - zip -r latest.zip dcmtk/$TYPE
  - mkdir -p dpl_cd_upload
  - mv latest.zip $TRAVIS_BUILD_DIR/../dpl_cd_upload/dcmtk-$TRAVIS_OS_NAME.zip
deploy:
  provider: s3
  access_key_id: AKIAJLIJS2MGONMUBW4A
  secret_access_key:
    secure: t04V7/n5MBI+vPYvd1nw/jAS+BMyFhUHWUBzZR62FpDzXI49vfJ7Bs4UJ340j2AWgoDfz2oij2f5rQIKL09Pd1436XeheHzXBuL8DDAMrGlLC33Z3vJgwCxE7dYTtbzoAZHXrIO86mSU9OGoTPl8oGHcsp/mw6gKws4gkwd4HBpMyq61je7rsbYOUePkhyBR9/+KIkDjqnqyKcayYKwKWbpfdMaGDH4sMqpXxI7fd2TAx/ars905QDkYfQ+sdAdIE4dMmPGSKL072m/Y8NGFgtvuz65mABmC62l11eXDSQG4vqmiSpg9Y+YlLWak8+6pcB2lM63zHcN+SpXBwTNc9zcEZCcDEK78wNzWP9NlsZDYz2Yx4KDSlYyUlCasDzPjwUEyfYm5WgL6ZidufInt0tK0ifJLdM7knrPgWfaVbTu0Th+o5BDzUWFw2Ck9wYXF756j6OJbgzv+N8vFY2cw3gXWRoa6jwIJPxqJsd/xW5YTS3DvQFKxzGmPjX5W5zCRsVbagnVpJ49lm8tsgHeNxjcyaHKXqJa5pt82+Ii2qH2HL8ZzxqHc53KeKg9Cj3vSujLjsrcPQ4gVycBkeSht+4eoe9uMAishDLBjRVd5ESs6tihD1VUSx0YGcvE8LYiV9YieFaV7U8BXc+1zI2B1+FUhcnGP2SnYehKIBYHN8ak=
  bucket: draconpern-buildcache
  acl: public_read
  skip_cleanup: true
  local_dir: dpl_cd_upload
  on:
    branch: ci
